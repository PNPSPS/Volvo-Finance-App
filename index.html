<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volvo Finance Service</title>
    
    <!-- 1. ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Tailwind CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡∏™‡∏ß‡∏¢‡πÜ -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Import Map ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á React ‡πÅ‡∏•‡∏∞ Firebase ‡∏°‡∏≤‡πÉ‡∏ä‡πâ -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.309.0",
        "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"
      }
    }
    </script>

    <!-- 3. ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Babel ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î React (JSX) ‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Prompt', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #F8FAFC; }
        .glass-panel { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
        /* Animation Utility */
        .animate-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
    
    <!-- Link Font -->
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <div id="root"></div>

    <!-- 4. ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° (Application Code) -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Wallet, PlusCircle, MinusCircle, CheckCircle2, XCircle, 
            History, User, LogOut, AlertCircle, TrendingUp, TrendingDown, 
            Clock, Building2, Lock, UserPlus, PieChart, CreditCard, 
            ChevronRight, Sparkles, Settings, RefreshCw
        } from 'lucide-react';
        import { initializeApp } from 'firebase/app';
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from 'firebase/auth';
        import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc, serverTimestamp } from 'firebase/firestore';

        // --- Config Manager Component (UPDATED) ---
        // ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤ Config ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î JavaScript Object ‡∏à‡∏≤‡∏Å Firebase Console ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
        const ConfigScreen = ({ onSave }) => {
            const [configInput, setConfigInput] = useState('');
            const [error, setError] = useState('');

            const handleSave = () => {
                try {
                    let cleaned = configInput.trim();
                    
                    // 1. ‡∏•‡∏ö const firebaseConfig = ‡∏´‡∏£‡∏∑‡∏≠ var ... ‡∏≠‡∏≠‡∏Å
                    cleaned = cleaned.replace(/^(const|var|let)\s+firebaseConfig\s*=\s*/, '');
                    
                    // 2. ‡∏•‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ ; ‡∏ï‡∏±‡∏ß‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                    cleaned = cleaned.replace(/;$/, '');

                    // 3. ‡πÉ‡∏ä‡πâ Function Constructor ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏õ‡∏•‡∏á string ‡πÄ‡∏õ‡πá‡∏ô object (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á JSON ‡πÅ‡∏•‡∏∞ JS Object)
                    // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏µ‡πâ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Å‡∏ß‡πà‡∏≤ eval ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡∏Å‡∏ß‡πà‡∏≤ JSON.parse
                    const json = new Function('return ' + cleaned)();
                    
                    if (!json || !json.apiKey) {
                        throw new Error("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡πà‡∏≤ apiKey ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏");
                    }

                    onSave(json);
                } catch (e) {
                    console.error(e);
                    setError('‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏°‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î "const firebaseConfig = { ... };" ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö Firebase ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏Ñ‡∏£‡∏±‡∏ö');
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4 bg-slate-100">
                    <div className="bg-white p-8 rounded-2xl shadow-xl max-w-md w-full animate-in">
                        <div className="w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4 text-blue-500">
                            <Settings size={32} />
                        </div>
                        <h2 className="text-xl font-bold text-center mb-2 text-slate-800">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</h2>
                        <p className="text-sm text-slate-500 text-center mb-6">
                            ‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î <b>firebaseConfig</b> ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡πá‡∏ö Firebase ‡∏•‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á<br/>
                            <span className="text-xs text-slate-400">(‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏°‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏Å‡πâ‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ const... ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö)</span>
                        </p>
                        <textarea 
                            value={configInput}
                            onChange={(e) => setConfigInput(e.target.value)}
                            placeholder={'const firebaseConfig = {\n  apiKey: "AIzaSy...",\n  authDomain: "..."\n};'}
                            className="w-full h-48 p-4 border border-slate-200 rounded-xl text-xs font-mono mb-4 focus:ring-2 focus:ring-blue-500 outline-none bg-slate-50 text-slate-600"
                        ></textarea>
                        {error && (
                            <div className="bg-rose-50 text-rose-600 text-xs p-3 rounded-lg mb-4 text-center border border-rose-100 flex items-center justify-center gap-2">
                                <AlertCircle size={14}/> {error}
                            </div>
                        )}
                        <button onClick={handleSave} className="w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 transition shadow-lg shadow-blue-500/30">
                            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                        </button>
                        <p className="text-xs text-slate-400 mt-4 text-center">
                            *‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
                        </p>
                    </div>
                </div>
            );
        };

        // --- Constants & Utilities ---
        const INCOME_CATEGORIES = [
            { id: 'scrap', label: '‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤/‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•', color: 'bg-orange-100 text-orange-700', icon: '‚ôªÔ∏è' },
            { id: 'contribution', label: '‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏°‡∏ó‡∏ö/‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ', color: 'bg-indigo-100 text-indigo-700', icon: 'ü§ù' },
            { id: 'fine', label: '‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö', color: 'bg-rose-100 text-rose-700', icon: '‚ö†Ô∏è' },
            { id: 'activity', label: '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏©', color: 'bg-purple-100 text-purple-700', icon: 'üéâ' },
            { id: 'other', label: '‡∏≠‡∏∑‡πà‡∏ô‡πÜ', color: 'bg-slate-100 text-slate-700', icon: 'üì¶' }
        ];

        const formatMoney = (num) => new Intl.NumberFormat('th-TH', { style: 'currency', currency: 'THB' }).format(num);
        const formatDate = (ts) => ts ? new Date(ts.seconds * 1000).toLocaleDateString('th-TH', { day: 'numeric', month: 'short', year: '2-digit', hour: '2-digit', minute: '2-digit' }) : 'Just now';

        const Badge = ({ status }) => {
            const styles = {
                pending: "bg-amber-50 text-amber-700 ring-1 ring-amber-600/20",
                approved: "bg-emerald-50 text-emerald-700 ring-1 ring-emerald-600/20",
                rejected: "bg-rose-50 text-rose-700 ring-1 ring-rose-600/20",
                manager: "bg-indigo-50 text-indigo-700 ring-1 ring-indigo-600/20",
                staff: "bg-slate-50 text-slate-600 ring-1 ring-slate-600/20"
            };
            return <span className={`px-2.5 py-1 rounded-md text-[10px] font-semibold tracking-wide uppercase ${styles[status] || styles.staff}`}>{status}</span>;
        };

        const Button = ({ children, onClick, variant = "primary", className = "", disabled = false, type = "button" }) => {
            const variants = {
                primary: "bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 text-white shadow-lg shadow-blue-500/30",
                secondary: "bg-white border border-slate-200 text-slate-700 hover:bg-slate-50",
                danger: "bg-rose-50 hover:bg-rose-100 text-rose-600 border border-rose-200",
                success: "bg-emerald-600 hover:bg-emerald-700 text-white shadow-lg shadow-emerald-500/30"
            };
            return (
                <button type={type} onClick={onClick} disabled={disabled} className={`px-4 py-2.5 rounded-xl font-medium transition-all active:scale-95 disabled:opacity-50 flex items-center justify-center gap-2 ${variants[variant]} ${className}`}>
                    {children}
                </button>
            );
        };

        // --- Main App Component ---
        const App = () => {
            // State for Firebase Config
            const [firebaseConfig, setFirebaseConfig] = useState(() => {
                const local = localStorage.getItem('vfs_firebase_config');
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ Global config ‡∏à‡∏≤‡∏Å environment ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                if (typeof __firebase_config !== 'undefined') return JSON.parse(__firebase_config);
                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ä‡πâ local storage
                return local ? JSON.parse(local) : null;
            });

            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ Config ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
            if (!firebaseConfig) {
                return <ConfigScreen onSave={(cfg) => {
                    localStorage.setItem('vfs_firebase_config', JSON.stringify(cfg));
                    setFirebaseConfig(cfg);
                    window.location.reload(); 
                }} />;
            }

            // Initialize Firebase
            const app = useMemo(() => initializeApp(firebaseConfig), [firebaseConfig]);
            const auth = useMemo(() => getAuth(app), [app]);
            const db = useMemo(() => getFirestore(app), [app]);
            // ‡πÉ‡∏ä‡πâ App ID ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'volvo-service-fund';

            // ... State Definitions ...
            const [user, setUser] = useState(null);
            const [currentUserData, setCurrentUserData] = useState(null);
            const [transactions, setTransactions] = useState([]);
            const [requests, setRequests] = useState([]);
            const [profiles, setProfiles] = useState([]);
            
            // UI States
            const [activeTab, setActiveTab] = useState('dashboard');
            const [showRequestModal, setShowRequestModal] = useState(false);
            const [showDepositModal, setShowDepositModal] = useState(false);
            const [showRegisterModal, setShowRegisterModal] = useState(false);
            const [selectedProfile, setSelectedProfile] = useState(null);
            const [pinInput, setPinInput] = useState('');
            const [loginError, setLoginError] = useState('');
            const [registerSuccessMsg, setRegisterSuccessMsg] = useState('');

            // Form States
            const [amount, setAmount] = useState('');
            const [description, setDescription] = useState('');
            const [depositCategory, setDepositCategory] = useState('scrap');
            const [newName, setNewName] = useState('');
            const [newRole, setNewRole] = useState('staff');
            const [newPin, setNewPin] = useState('');

            // --- Effects ---
            useEffect(() => {
                const initAuth = async () => {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await signInWithCustomToken(auth, __initial_auth_token);
                    } else {
                        await signInAnonymously(auth);
                    }
                };
                initAuth();
                return onAuthStateChanged(auth, setUser);
            }, [auth]);

            useEffect(() => {
                if (!user) return;
                
                // Real-time Listeners
                const unsubUsers = onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'users'), (snap) => {
                    const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setProfiles(data);
                    
                    // --- INTELLIGENT AUTO-SEED (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡∏°‡πà) ---
                    // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ Manager ‡∏ó‡∏µ‡πà Active ‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏´‡∏° ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏•‡∏¢ -> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô "‡πÄ‡∏û‡∏¥‡∏£‡πå‡∏ò"
                    // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏µ‡πâ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Deadlock ‡∏Å‡∏£‡∏ì‡∏µ‡∏°‡∏µ User ‡∏≠‡∏∑‡πà‡∏ô‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô
                    const hasActiveManager = data.some(u => u.role === 'manager' && u.status === 'active');
                    
                    if (!hasActiveManager) {
                        const existingAdmin = data.find(u => u.name === '‡πÄ‡∏û‡∏¥‡∏£‡πå‡∏ò' && u.role === 'manager');
                        if (existingAdmin) {
                            // ‡∏°‡∏µ User ‡πÄ‡∏û‡∏¥‡∏£‡πå‡∏ò‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà Active -> ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö Active ‡πÄ‡∏•‡∏¢
                            updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'users', existingAdmin.id), { status: 'active' });
                        } else {
                            // ‡πÑ‡∏°‡πà‡∏°‡∏µ User ‡πÄ‡∏û‡∏¥‡∏£‡πå‡∏ò‡πÄ‡∏•‡∏¢ -> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
                            addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'users'), {
                                name: '‡πÄ‡∏û‡∏¥‡∏£‡πå‡∏ò', role: 'manager', pin: '2121', status: 'active', createdAt: serverTimestamp()
                            });
                        }
                    }
                });

                const unsubTx = onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'transactions'), (snap) => {
                    const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    data.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
                    setTransactions(data);
                });

                const unsubReq = onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'requests'), (snap) => {
                    const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    data.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
                    setRequests(data);
                });

                return () => { unsubUsers(); unsubTx(); unsubReq(); };
            }, [user, db, appId]);

            // --- Logic ---
            const balance = useMemo(() => transactions.reduce((acc, curr) => curr.type === 'income' ? acc + parseFloat(curr.amount) : acc - parseFloat(curr.amount), 0), [transactions]);
            const pendingRequests = requests.filter(r => r.status === 'pending');
            const pendingUsers = profiles.filter(p => p.status === 'pending');
            const activeProfiles = profiles.filter(p => !p.status || p.status === 'active');
            const totalPending = pendingRequests.length + pendingUsers.length;

            const handleLogin = (e) => {
                e.preventDefault();
                if(pinInput === selectedProfile.pin) {
                    setCurrentUserData(selectedProfile);
                    setSelectedProfile(null);
                    setPinInput('');
                    setLoginError('');
                } else {
                    setLoginError('‡∏£‡∏´‡∏±‡∏™ PIN ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                    setPinInput('');
                }
            };

            const handleRegister = async (e) => {
                e.preventDefault();
                if(newPin.length < 4) return;
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'users'), {
                    name: newName, role: newRole, pin: newPin, status: 'pending', createdAt: serverTimestamp()
                });
                setNewName(''); setNewPin(''); setShowRegisterModal(false);
                setRegisterSuccessMsg('‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥');
                setTimeout(() => setRegisterSuccessMsg(''), 5000);
            };
            
            // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö (Manual Trigger)
            const restoreAdmin = async () => {
                if(!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á/‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ "‡πÄ‡∏û‡∏¥‡∏£‡πå‡∏ò (2121)"?')) return;
                const existingAdmin = profiles.find(u => u.name === '‡πÄ‡∏û‡∏¥‡∏£‡πå‡∏ò' && u.role === 'manager');
                if (existingAdmin) {
                    await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'users', existingAdmin.id), { status: 'active', pin: '2121' });
                } else {
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'users'), {
                        name: '‡πÄ‡∏û‡∏¥‡∏£‡πå‡∏ò', role: 'manager', pin: '2121', status: 'active', createdAt: serverTimestamp()
                    });
                }
                alert('‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà');
                window.location.reload();
            };

            const submitRequest = async (e) => {
                e.preventDefault();
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'requests'), {
                    amount: parseFloat(amount), description, requester: currentUserData.name, requesterId: currentUserData.id, status: 'pending', createdAt: serverTimestamp(), type: 'expense'
                });
                setAmount(''); setDescription(''); setShowRequestModal(false);
            };

            const submitDeposit = async (e) => {
                e.preventDefault();
                const cat = INCOME_CATEGORIES.find(c => c.id === depositCategory);
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'transactions'), {
                    amount: parseFloat(amount), description, category: depositCategory, categoryLabel: cat?.label, performer: currentUserData.name, type: 'income', createdAt: serverTimestamp()
                });
                setAmount(''); setDescription(''); setShowDepositModal(false);
            };

            // --- Render: Login Screen ---
            if (!currentUserData) {
                return (
                    <div className="min-h-screen bg-slate-50 flex items-center justify-center p-4 relative overflow-hidden">
                        <div className="absolute top-0 left-0 w-full h-full pointer-events-none">
                            <div className="absolute top-[-10%] right-[-10%] w-[500px] h-[500px] bg-blue-100/50 rounded-full blur-3xl opacity-60"></div>
                            <div className="absolute bottom-[-10%] left-[-10%] w-[400px] h-[400px] bg-indigo-100/50 rounded-full blur-3xl opacity-60"></div>
                        </div>

                        <div className="w-full max-w-lg relative z-10 animate-in">
                            <div className="text-center mb-10">
                                <div className="w-20 h-20 bg-gradient-to-tr from-blue-600 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-5 shadow-xl shadow-blue-500/20 rotate-3">
                                    <Building2 className="text-white w-10 h-10" />
                                </div>
                                <h1 className="text-3xl font-bold text-slate-800 mb-2">Volvo Finance</h1>
                                <p className="text-slate-500 font-medium">Service Center Fund Management</p>
                            </div>

                            {registerSuccessMsg && (
                                <div className="mb-6 bg-emerald-50 border border-emerald-100 text-emerald-700 p-4 rounded-xl flex items-center gap-3 shadow-sm">
                                    <CheckCircle2 size={16} /> <span className="text-sm font-medium">{registerSuccessMsg}</span>
                                </div>
                            )}

                            <div className="grid grid-cols-2 sm:grid-cols-3 gap-4 mb-8">
                                {activeProfiles.map(profile => (
                                    <button key={profile.id} onClick={() => { setSelectedProfile(profile); setLoginError(''); setPinInput(''); }}
                                        className="bg-white p-5 rounded-2xl border border-slate-100 shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-200 flex flex-col items-center gap-4 group relative overflow-hidden">
                                        <div className={`w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold transition-all ${profile.role === 'manager' ? 'bg-indigo-50 text-indigo-600 group-hover:bg-indigo-600 group-hover:text-white' : 'bg-slate-50 text-slate-600 group-hover:bg-slate-600 group-hover:text-white'}`}>
                                            {profile.name.charAt(0)}
                                        </div>
                                        <div className="text-center w-full">
                                            <div className="font-bold text-slate-800 truncate text-base mb-1">{profile.name}</div>
                                            <Badge status={profile.role} />
                                        </div>
                                    </button>
                                ))}
                                <button onClick={() => setShowRegisterModal(true)} className="bg-slate-50 border-2 border-dashed border-slate-200 rounded-2xl p-4 flex flex-col items-center justify-center gap-3 text-slate-400 hover:text-slate-600 hover:border-slate-300 hover:bg-slate-100 transition-all min-h-[160px]">
                                    <div className="w-12 h-12 rounded-full bg-white flex items-center justify-center shadow-sm"><PlusCircle className="w-6 h-6" /></div>
                                    <span className="text-sm font-medium">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
                                </button>
                            </div>
                            
                            <div className="text-center mt-8">
                                <button onClick={restoreAdmin} className="text-xs text-slate-400 hover:text-blue-500 underline flex items-center justify-center gap-1 mx-auto">
                                    <RefreshCw size={10} /> ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ (Restore Admin)
                                </button>
                            </div>
                        </div>

                        {/* PIN Modal */}
                        {selectedProfile && (
                            <div className="fixed inset-0 bg-slate-900/40 backdrop-blur-md z-50 flex items-center justify-center p-4">
                                <div className="bg-white w-full max-w-xs p-8 rounded-2xl shadow-2xl animate-in">
                                    <div className="text-center mb-6">
                                        <h3 className="font-bold text-xl text-slate-800">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö, {selectedProfile.name}</h3>
                                        <p className="text-slate-500 text-sm">‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™ PIN 4 ‡∏´‡∏•‡∏±‡∏Å</p>
                                    </div>
                                    <form onSubmit={handleLogin} className="space-y-6">
                                        <div className="relative group">
                                            <input autoFocus type="password" maxLength="6" value={pinInput} onChange={(e) => setPinInput(e.target.value)}
                                                className="w-full text-center text-4xl tracking-[0.5em] py-3 border-b-2 border-slate-200 focus:border-indigo-500 outline-none bg-transparent font-mono text-slate-800" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
                                            <Lock className="absolute left-4 top-5 text-slate-300 w-5 h-5" />
                                        </div>
                                        {loginError && <div className="bg-rose-50 text-rose-600 text-sm py-2 px-3 rounded-lg text-center font-medium">{loginError}</div>}
                                        <div className="flex gap-3 mt-8">
                                            <Button variant="secondary" onClick={() => setSelectedProfile(null)} className="flex-1 rounded-xl">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</Button>
                                            <Button type="submit" className="flex-1 rounded-xl" disabled={!pinInput}>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</Button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        )}

                        {/* Register Modal */}
                        {showRegisterModal && (
                            <div className="fixed inset-0 bg-slate-900/40 backdrop-blur-md z-50 flex items-center justify-center p-4">
                                <div className="bg-white w-full max-w-sm p-6 rounded-2xl shadow-2xl animate-in">
                                    <div className="flex justify-between items-center mb-6">
                                        <h3 className="text-xl font-bold flex items-center gap-2 text-slate-800"><UserPlus className="text-indigo-600" /> ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà</h3>
                                        <button onClick={() => setShowRegisterModal(false)}><XCircle size={20} className="text-slate-400" /></button>
                                    </div>
                                    <form onSubmit={handleRegister} className="space-y-5">
                                        <div><label className="text-sm font-semibold mb-2 block">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å</label><input type="text" value={newName} onChange={e=>setNewName(e.target.value)} className="w-full p-3 bg-slate-50 border rounded-xl" required /></div>
                                        <div><label className="text-sm font-semibold mb-2 block">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label><div className="flex gap-2"><button type="button" onClick={()=>setNewRole('staff')} className={`flex-1 p-2 rounded-lg border ${newRole==='staff'?'bg-slate-100 border-slate-400':'border-slate-200'}`}>‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</button><button type="button" onClick={()=>setNewRole('manager')} className={`flex-1 p-2 rounded-lg border ${newRole==='manager'?'bg-indigo-50 text-indigo-700 border-indigo-400':'border-slate-200'}`}>‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</button></div></div>
                                        <div><label className="text-sm font-semibold mb-2 block">PIN (4 ‡∏´‡∏•‡∏±‡∏Å)</label><input type="text" maxLength="4" value={newPin} onChange={e=>setNewPin(e.target.value)} className="w-full p-3 bg-slate-50 border rounded-xl text-center tracking-widest" required /></div>
                                        <Button type="submit" className="w-full">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</Button>
                                    </form>
                                </div>
                            </div>
                        )}
                    </div>
                );
            }

            // --- Render: Main App ---
            return (
                <div className="min-h-screen bg-[#F8FAFC] font-sans text-slate-800 pb-24 md:pb-0 animate-in">
                    <header className="bg-white/80 backdrop-blur-md border-b border-slate-200/60 sticky top-0 z-20">
                        <div className="max-w-3xl mx-auto px-4 py-3 flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <div className="w-10 h-10 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-xl flex items-center justify-center text-white font-bold text-lg shadow-lg">V</div>
                                <div><h1 className="font-bold text-slate-800 text-sm md:text-base">Volvo Finance</h1><div className="flex items-center gap-2 text-xs text-slate-500"><span>{currentUserData.name}</span></div></div>
                            </div>
                            <button onClick={() => { setCurrentUserData(null); setActiveTab('dashboard'); }} className="p-2 hover:bg-slate-100 rounded-lg text-slate-500"><LogOut size={20} /></button>
                        </div>
                    </header>

                    <main className="max-w-3xl mx-auto p-4 space-y-6">
                        {/* Balance Card */}
                        <div className="relative overflow-hidden bg-gradient-to-br from-[#0F172A] via-[#1E293B] to-[#0F172A] rounded-3xl p-6 text-white shadow-2xl">
                             <div className="relative z-10 flex flex-col h-full justify-between min-h-[160px]">
                                <div className="flex justify-between items-start">
                                    <div className="flex items-center gap-2 text-slate-300 bg-white/5 px-3 py-1 rounded-full backdrop-blur-md border border-white/10"><CreditCard size={14} /> <span className="text-xs font-medium tracking-wide">Service Fund</span></div>
                                    <Building2 className="text-slate-500 opacity-50" size={24} />
                                </div>
                                <div>
                                    <div className="text-slate-400 text-xs font-medium mb-1 uppercase tracking-wider">Total Balance</div>
                                    <div className="text-4xl sm:text-5xl font-bold tracking-tight text-white">{formatMoney(balance)}</div>
                                </div>
                            </div>
                        </div>

                        {/* Actions */}
                        <div className="grid grid-cols-2 gap-4">
                            <button onClick={() => setShowRequestModal(true)} className="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex items-center gap-4 hover:shadow-md transition-all">
                                <div className="w-12 h-12 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center"><MinusCircle size={24} /></div>
                                <div className="text-left"><div className="font-bold text-slate-800">‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</div><div className="text-xs text-slate-500">Request Expense</div></div>
                            </button>
                            {currentUserData.role === 'manager' && (
                                <button onClick={() => setShowDepositModal(true)} className="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex items-center gap-4 hover:shadow-md transition-all">
                                    <div className="w-12 h-12 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center"><PlusCircle size={24} /></div>
                                    <div className="text-left"><div className="font-bold text-slate-800">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</div><div className="text-xs text-slate-500">Add Income</div></div>
                                </button>
                            )}
                        </div>

                        {/* Manager Alerts */}
                        {currentUserData.role === 'manager' && totalPending > 0 && (
                            <div onClick={() => setActiveTab('approvals')} className="bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-100 rounded-2xl p-4 flex items-center justify-between cursor-pointer hover:shadow-md transition-all">
                                <div className="flex items-center gap-4">
                                    <div className="w-12 h-12 bg-white rounded-full flex items-center justify-center text-amber-500 shadow-sm"><AlertCircle size={24} /></div>
                                    <div><h3 className="font-bold text-slate-800">‡∏°‡∏µ {totalPending} ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</h3><div className="text-xs text-slate-500">{pendingRequests.length} ‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å ‚Ä¢ {pendingUsers.length} ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà</div></div>
                                </div>
                                <ChevronRight className="text-slate-400" />
                            </div>
                        )}

                        {/* Tabs */}
                        <div className="flex p-1 bg-slate-200/50 rounded-xl">
                            {['dashboard', 'myRequests'].map(tab => (
                                <button key={tab} onClick={() => setActiveTab(tab)} className={`flex-1 py-2 text-sm font-medium rounded-lg transition-all ${activeTab === tab ? 'bg-white text-blue-700 shadow-sm' : 'text-slate-500'}`}>
                                    {tab === 'dashboard' ? '‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°' : '‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô'}
                                </button>
                            ))}
                            {currentUserData.role === 'manager' && (
                                <button onClick={() => setActiveTab('approvals')} className={`flex-1 py-2 text-sm font-medium rounded-lg transition-all ${activeTab === 'approvals' ? 'bg-white text-blue-700 shadow-sm' : 'text-slate-500'}`}>
                                    ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ {totalPending > 0 && `(${totalPending})`}
                                </button>
                            )}
                        </div>

                        {/* Content: Dashboard */}
                        {activeTab === 'dashboard' && (
                            <div className="space-y-3">
                                <h3 className="text-sm font-bold text-slate-800 flex items-center gap-2"><History size={16} /> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                                {transactions.length === 0 ? <p className="text-center text-slate-400 py-8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß</p> : 
                                    transactions.map(tx => (
                                        <div key={tx.id} className="bg-white p-4 rounded-2xl flex justify-between items-center border border-slate-100 shadow-sm">
                                            <div className="flex items-center gap-4">
                                                <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${tx.type === 'income' ? 'bg-emerald-50 text-emerald-600' : 'bg-slate-50 text-slate-500'}`}>{tx.type === 'income' ? <TrendingUp size={20} /> : <TrendingDown size={20} />}</div>
                                                <div><p className="font-bold text-slate-800">{tx.description}</p><p className="text-xs text-slate-400">{formatDate(tx.createdAt)} ‚Ä¢ {tx.performer}</p></div>
                                            </div>
                                            <span className={`font-bold ${tx.type === 'income' ? 'text-emerald-600' : 'text-slate-800'}`}>{tx.type === 'income' ? '+' : '-'}{formatMoney(tx.amount)}</span>
                                        </div>
                                    ))
                                }
                            </div>
                        )}

                        {/* Content: My Requests */}
                        {activeTab === 'myRequests' && (
                            <div className="space-y-3">
                                {requests.filter(r => currentUserData.role === 'manager' || r.requester === currentUserData.name).map(req => (
                                    <div key={req.id} className="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm">
                                        <div className="flex justify-between mb-2">
                                            <p className="font-bold text-slate-800">{req.description}</p>
                                            <Badge status={req.status} />
                                        </div>
                                        <div className="flex justify-between items-end text-sm">
                                            <span className="text-slate-400">{formatDate(req.createdAt)}</span>
                                            <span className="font-bold text-lg">{formatMoney(req.amount)}</span>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {/* Content: Approvals */}
                        {activeTab === 'approvals' && currentUserData.role === 'manager' && (
                            <div className="space-y-6">
                                {pendingUsers.length > 0 && (
                                    <div className="space-y-3">
                                        <h4 className="text-sm font-bold text-slate-700">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà ({pendingUsers.length})</h4>
                                        {pendingUsers.map(u => (
                                            <div key={u.id} className="bg-blue-50/50 p-4 rounded-2xl border border-blue-100 flex justify-between items-center">
                                                <div className="flex items-center gap-3"><div className="w-10 h-10 bg-white rounded-full flex items-center justify-center font-bold text-blue-600">{u.name.charAt(0)}</div><div><p className="font-bold text-slate-800">{u.name}</p><span className="text-xs bg-slate-100 px-2 py-0.5 rounded text-slate-600">{u.role}</span></div></div>
                                                <div className="flex gap-2"><Button onClick={() => updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'users', u.id), { status: 'active' })} variant="primary" className="py-1 px-3 text-xs h-8">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</Button><Button onClick={() => deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'users', u.id))} variant="danger" className="py-1 px-3 text-xs h-8">‡∏•‡∏ö</Button></div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                <div className="space-y-3">
                                    <h4 className="text-sm font-bold text-slate-700">‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å ({pendingRequests.length})</h4>
                                    {pendingRequests.map(req => (
                                        <div key={req.id} className="bg-white p-4 rounded-2xl border border-l-4 border-l-amber-400 border-slate-100 shadow-sm">
                                            <div className="flex justify-between mb-3">
                                                <div><p className="font-bold text-lg text-slate-800">{req.description}</p><p className="text-xs text-slate-400 mt-1">‡πÇ‡∏î‡∏¢ {req.requester}</p></div>
                                                <div className="text-right"><p className="font-bold text-xl">{formatMoney(req.amount)}</p><span className="text-[10px] bg-amber-50 text-amber-600 px-2 py-0.5 rounded-full font-bold">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span></div>
                                            </div>
                                            <div className="flex gap-2 pt-2 border-t border-slate-50">
                                                <Button onClick={async () => {
                                                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'transactions'), { amount: parseFloat(req.amount), description: req.description, performer: req.requester, approver: currentUserData.name, type: 'expense', createdAt: serverTimestamp() });
                                                    await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'requests', req.id), { status: 'approved' });
                                                }} variant="success" className="flex-1 py-2">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</Button>
                                                <Button onClick={() => updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'requests', req.id), { status: 'rejected' })} variant="danger" className="flex-1 py-2">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</Button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </main>

                    {/* Modals for Requests & Deposits would go here (Simplified for brevity in single file, reusing logic above) */}
                    {/* ... (Modal logic is handled by state showRequestModal/showDepositModal rendering inline above if we wanted, but for cleaner code kept in main logic) ... */}
                    {/* Re-implementing simplified modals inline for single-file portability */}
                    
                    {showRequestModal && (
                        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-white w-full max-w-sm p-6 rounded-2xl shadow-xl animate-in">
                                <h3 className="font-bold text-lg mb-4">‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</h3>
                                <input autoFocus className="w-full p-3 border rounded-xl mb-3" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£" value={description} onChange={e=>setDescription(e.target.value)} />
                                <input type="number" className="w-full p-3 border rounded-xl mb-6" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô" value={amount} onChange={e=>setAmount(e.target.value)} />
                                <div className="flex gap-2"><Button onClick={()=>setShowRequestModal(false)} variant="secondary" className="flex-1">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</Button><Button onClick={submitRequest} className="flex-1">‡∏™‡πà‡∏á</Button></div>
                            </div>
                        </div>
                    )}
                    
                    {showDepositModal && (
                        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-white w-full max-w-sm p-6 rounded-2xl shadow-xl animate-in">
                                <h3 className="font-bold text-lg mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</h3>
                                <select className="w-full p-3 border rounded-xl mb-3 bg-white" value={depositCategory} onChange={e=>setDepositCategory(e.target.value)}>
                                    {INCOME_CATEGORIES.map(c => <option key={c.id} value={c.id}>{c.icon} {c.label}</option>)}
                                </select>
                                <input className="w-full p-3 border rounded-xl mb-3" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î" value={description} onChange={e=>setDescription(e.target.value)} />
                                <input type="number" className="w-full p-3 border rounded-xl mb-6" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô" value={amount} onChange={e=>setAmount(e.target.value)} />
                                <div className="flex gap-2"><Button onClick={()=>setShowDepositModal(false)} variant="secondary" className="flex-1">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</Button><Button onClick={submitDeposit} variant="success" className="flex-1">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</Button></div>
                            </div>
                        </div>
                    )}

                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>