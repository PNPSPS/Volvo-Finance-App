<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volvo Finance Service (Auto-Fix)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM (UMD - Works locally) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase Compat (Works locally) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style> 
        body { 
            font-family: 'Prompt', sans-serif; 
            background-image: url('https://images.unsplash.com/photo-1619642751034-765dfdf7c58e?q=80&w=2574&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            min-height: 100vh;
        }
        #root {
            background-color: rgba(241, 245, 249, 0.85);
            min-height: 100vh;
            backdrop-filter: blur(8px);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Icons ---
        const Icon = ({ name, size = 20, className = "" }) => {
            const paths = {
                wallet: "M21 12V7H5a2 2 0 0 1 0-4h14v4M3 5v14a2 2 0 0 0 2 2h16v-5M18 12a2 2 0 0 0 0 4h4v-4h-4z",
                plusCircle: "M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM12 8v8M8 12h8",
                minusCircle: "M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM8 12h8",
                history: "M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8 M3 3v5h5 M12 7v5l4 2",
                user: "M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2 M12 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8z",
                logout: "M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4 M16 17l5-5-5-5 M21 12H9",
                alert: "M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0zM12 9v4M12 17h.01",
                trendingUp: "M23 6l-9.5 9.5-5-5L1 18",
                trendingDown: "M23 18l-9.5-9.5-5 5L1 6",
                clock: "M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM12 6v6l4 2",
                building: "M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18 M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2 M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2 M10 6h4 M10 10h4 M10 14h4 M10 18h4",
                lock: "M19 11H5a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-6a2 2 0 0 0-2-2zM7 11V7a5 5 0 0 1 10 0v4",
                userPlus: "M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2 M8.5 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8z M20 8v6 M23 11h-6",
                creditCard: "M21 4H3a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zM1 10h22",
                settings: "M12.22 2h-.44a2 2 0 0 1-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z",
                refresh: "M23 4v6h-6 M1 20v-6h6 M3.51 9a9 9 0 0 1 14.85-3.36L23 10 M1 14l4.64 4.36A9 9 0 0 0 20.49 15",
                shieldAlert: "M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z M12 8v4 M12 16h.01",
            };
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d={paths[name] || ""} />
                </svg>
            );
        };

        // --- Config Screen ---
        const ConfigScreen = ({ onSave }) => {
            const [configInput, setConfigInput] = useState('');
            const [error, setError] = useState('');

            const handleSave = () => {
                try {
                    let cleaned = configInput.trim();
                    cleaned = cleaned.replace(/^(const|var|let)\s+firebaseConfig\s*=\s*/, '').replace(/;$/, '');
                    const json = new Function('return ' + cleaned)();
                    if (!json || !json.apiKey) throw new Error("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡πà‡∏≤ apiKey");
                    onSave(json);
                } catch (e) {
                    setError('Format ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏°‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î const firebaseConfig = { ... }; ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö');
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="bg-white/90 backdrop-blur-xl p-8 rounded-2xl shadow-xl max-w-md w-full border border-white/50">
                        <div className="w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4 text-blue-500">
                            <Icon name="settings" size={32} />
                        </div>
                        <h2 className="text-xl font-bold text-center mb-4 text-slate-800">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</h2>
                        <textarea 
                            value={configInput}
                            onChange={(e) => setConfigInput(e.target.value)}
                            placeholder={'const firebaseConfig = {\n  apiKey: "AIzaSy...",\n  authDomain: "..."\n};'}
                            className="w-full h-48 p-4 border rounded-xl text-xs font-mono mb-4 bg-white/50 focus:ring-2 focus:ring-blue-500 outline-none"
                        ></textarea>
                        {error && <p className="text-rose-500 text-xs mb-4 text-center">{error}</p>}
                        <button onClick={handleSave} className="w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 transition shadow-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
                    </div>
                </div>
            );
        };

        const INCOME_CATEGORIES = [
            { id: 'scrap', label: '‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤/‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•', color: 'bg-orange-100 text-orange-700', icon: '‚ôªÔ∏è' },
            { id: 'contribution', label: '‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏°‡∏ó‡∏ö/‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ', color: 'bg-indigo-100 text-indigo-700', icon: 'ü§ù' },
            { id: 'fine', label: '‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö', color: 'bg-rose-100 text-rose-700', icon: '‚ö†Ô∏è' },
            { id: 'activity', label: '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏©', color: 'bg-purple-100 text-purple-700', icon: 'üéâ' },
            { id: 'other', label: '‡∏≠‡∏∑‡πà‡∏ô‡πÜ', color: 'bg-slate-100 text-slate-700', icon: 'üì¶' }
        ];

        // --- Main App ---
        const App = () => {
            const [firebaseConfig, setFirebaseConfig] = useState(() => {
                const local = localStorage.getItem('vfs_firebase_config');
                if (typeof __firebase_config !== 'undefined') return JSON.parse(__firebase_config);
                return local ? JSON.parse(local) : null;
            });

            const [fbApp, setFbApp] = useState(null);
            const [auth, setAuth] = useState(null);
            const [db, setDb] = useState(null);
            const [isInitialized, setIsInitialized] = useState(false);
            const [permissionError, setPermissionError] = useState(false);

            useEffect(() => {
                if (firebaseConfig && !firebase.apps.length) {
                    try {
                        const app = firebase.initializeApp(firebaseConfig);
                        setFbApp(app);
                        setAuth(firebase.auth());
                        setDb(firebase.firestore());
                        setIsInitialized(true);
                    } catch (e) {
                        alert("Config Error: " + e.message);
                        setFirebaseConfig(null);
                    }
                } else if (firebase.apps.length) {
                    setFbApp(firebase.app());
                    setAuth(firebase.auth());
                    setDb(firebase.firestore());
                    setIsInitialized(true);
                }
            }, [firebaseConfig]);

            const [user, setUser] = useState(null);
            const [currentUserData, setCurrentUserData] = useState(null);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [transactions, setTransactions] = useState([]);
            const [requests, setRequests] = useState([]);
            const [profiles, setProfiles] = useState([]);
            
            // Modal States
            const [showRequestModal, setShowRequestModal] = useState(false);
            const [showDepositModal, setShowDepositModal] = useState(false);
            const [showRegisterModal, setShowRegisterModal] = useState(false);
            const [selectedProfile, setSelectedProfile] = useState(null);
            const [pinInput, setPinInput] = useState('');
            const [amount, setAmount] = useState('');
            const [description, setDescription] = useState('');
            const [depositCategory, setDepositCategory] = useState('scrap');
            const [newName, setNewName] = useState('');
            const [newRole, setNewRole] = useState('staff');
            const [newPin, setNewPin] = useState('');

            const appId = 'volvo-service-fund';

            useEffect(() => {
                if (!auth) return;
                const unsub = auth.onAuthStateChanged(u => {
                    setUser(u);
                    if (!u) {
                        auth.signInAnonymously().catch(e => {
                            console.error("Auth Error", e);
                        });
                    }
                });
                return () => unsub();
            }, [auth]);

            useEffect(() => {
                if (!user || !db) return;

                const usersRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('users');
                const txRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('transactions');
                const reqRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('requests');

                const unsubUsers = usersRef.onSnapshot(snap => {
                    const data = snap.docs.map(d => ({id: d.id, ...d.data()}));
                    setProfiles(data);
                    
                    // Intelligent Auto-Seed
                    const hasActiveManager = data.some(u => u.role === 'manager' && u.status === 'active');
                    if (!hasActiveManager && data.length === 0) {
                        usersRef.add({
                            name: '‡πÄ‡∏û‡∏¥‡∏£‡πå‡∏ò', role: 'manager', pin: '2121', status: 'active', createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                }, err => {
                    if (err.code === 'permission-denied') {
                        setPermissionError(true);
                    }
                });

                const unsubTx = txRef.orderBy('createdAt', 'desc').onSnapshot(snap => {
                    setTransactions(snap.docs.map(d => ({id: d.id, ...d.data()})));
                }, err => {});

                const unsubReq = reqRef.orderBy('createdAt', 'desc').onSnapshot(snap => {
                    setRequests(snap.docs.map(d => ({id: d.id, ...d.data()})));
                }, err => {});

                return () => { unsubUsers(); unsubTx(); unsubReq(); };
            }, [user, db]);

            const formatMoney = (num) => new Intl.NumberFormat('th-TH', { style: 'currency', currency: 'THB' }).format(num);
            const formatDate = (ts) => ts ? new Date(ts.seconds * 1000).toLocaleDateString('th-TH', { day: 'numeric', month: 'short', hour:'2-digit', minute:'2-digit'}) : '-';
            const balance = useMemo(() => transactions.reduce((acc, curr) => curr.type === 'income' ? acc + parseFloat(curr.amount) : acc - parseFloat(curr.amount), 0), [transactions]);
            
            const pendingRequests = requests.filter(r => r.status === 'pending');
            const pendingUsers = profiles.filter(p => p.status === 'pending');
            const totalPending = pendingRequests.length + pendingUsers.length;

            const handleLogin = (e) => {
                e.preventDefault();
                if(pinInput === selectedProfile.pin) { setCurrentUserData(selectedProfile); setSelectedProfile(null); setPinInput(''); }
                else alert("‡∏£‡∏´‡∏±‡∏™ PIN ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
            };

            const handleRegister = async (e) => {
                e.preventDefault();
                if(newPin.length < 4) return alert("PIN ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ 4 ‡∏´‡∏•‡∏±‡∏Å");
                try {
                    await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('users').add({
                        name: newName, role: newRole, pin: newPin, status: 'pending', createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    setShowRegisterModal(false); setNewName(''); setNewPin(''); alert("‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥");
                } catch(e) { alert("Error: " + e.message); }
            };

            const restoreAdmin = async () => {
                if(!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô/‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ "‡πÄ‡∏û‡∏¥‡∏£‡πå‡∏ò (2121)"?')) return;
                try {
                    const usersRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('users');
                    const snap = await usersRef.get();
                    const users = snap.docs.map(d => ({id: d.id, ...d.data()}));
                    const existingAdmin = users.find(u => u.name === '‡πÄ‡∏û‡∏¥‡∏£‡πå‡∏ò' && u.role === 'manager');

                    if(existingAdmin) {
                        await usersRef.doc(existingAdmin.id).update({status: 'active', pin: '2121'});
                        alert("‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï User ‡πÄ‡∏î‡∏¥‡∏°)");
                    } else {
                        await usersRef.add({
                            name: '‡πÄ‡∏û‡∏¥‡∏£‡πå‡∏ò', role: 'manager', pin: '2121', status: 'active', createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        alert("‡∏™‡∏£‡πâ‡∏≤‡∏á User ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
                    }
                    window.location.reload();
                } catch(e) { alert("‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: " + e.message); }
            };

            const submitRequest = async () => {
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('requests').add({
                    amount: parseFloat(amount), description, requester: currentUserData.name, requesterId: currentUserData.id, status: 'pending', createdAt: firebase.firestore.FieldValue.serverTimestamp(), type: 'expense'
                });
                setShowRequestModal(false); setAmount(''); setDescription('');
            };

            const submitDeposit = async () => {
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('transactions').add({
                    amount: parseFloat(amount), description, category: depositCategory, performer: currentUserData.name, type: 'income', createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                setShowDepositModal(false); setAmount(''); setDescription('');
            };

            const updateReqStatus = async (id, status, req) => {
                if(status === 'approved') {
                    await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('transactions').add({
                        amount: parseFloat(req.amount), description: req.description, performer: req.requester, approver: currentUserData.name, type: 'expense', createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('requests').doc(id).update({status});
            };

            if (!firebaseConfig) return <ConfigScreen onSave={(cfg) => { localStorage.setItem('vfs_firebase_config', JSON.stringify(cfg)); setFirebaseConfig(cfg); }} />;
            if (!isInitialized) return <div className="h-screen flex items-center justify-center text-slate-500">Connecting to Firebase...</div>;

            // --- Views ---
            if (!currentUserData) {
                const activeProfiles = profiles.filter(p => p.status === 'active');
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-4">
                        <div className="w-full max-w-lg mb-20 relative z-10">
                            <div className="text-center mb-8">
                                <div className="w-20 h-20 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-2xl flex items-center justify-center mx-auto mb-4 text-white shadow-xl shadow-blue-500/30">
                                    <Icon name="building" size={40}/>
                                </div>
                                <h1 className="text-3xl font-bold text-slate-800 drop-shadow-sm">Volvo Finance</h1>
                                <p className="text-slate-600 font-medium mt-1">Service Center Fund Management</p>
                            </div>
                            
                            {activeProfiles.length === 0 ? (
                                <button onClick={restoreAdmin} className="w-full bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-2xl shadow-xl flex flex-col items-center justify-center gap-2 transition-all transform hover:scale-105 mb-6">
                                    <Icon name="userPlus" size={32} />
                                    <span className="font-bold text-lg">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö / ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</span>
                                    <span className="text-xs opacity-80">(‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å)</span>
                                </button>
                            ) : (
                                <div className="grid grid-cols-2 gap-4 mb-6">
                                    {activeProfiles.map(p => (
                                        <button key={p.id} onClick={() => setSelectedProfile(p)} className="bg-white/80 backdrop-blur-md p-4 rounded-xl shadow-lg border border-white/50 hover:border-blue-500 hover:shadow-xl hover:-translate-y-1 transition-all flex flex-col items-center group">
                                            <div className="w-14 h-14 bg-slate-100 rounded-full flex items-center justify-center font-bold text-lg text-slate-700 mb-2 shadow-inner group-hover:bg-blue-100 group-hover:text-blue-700 transition-colors">{p.name[0]}</div>
                                            <div className="font-bold text-slate-800">{p.name}</div>
                                            <div className="text-xs text-slate-500 uppercase font-medium">{p.role}</div>
                                        </button>
                                    ))}
                                    <button onClick={() => setShowRegisterModal(true)} className="bg-white/50 backdrop-blur-sm border-2 border-dashed border-slate-300 rounded-xl p-4 flex flex-col items-center justify-center text-slate-500 hover:bg-white/80 hover:text-blue-600 hover:border-blue-400 transition-all shadow-sm">
                                        <Icon name="plusCircle" size={32} className="mb-2"/> <span className="font-medium">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏´‡∏°‡πà</span>
                                    </button>
                                </div>
                            )}
                            
                            <button onClick={restoreAdmin} className="w-full text-center text-xs text-slate-500 hover:text-blue-700 flex items-center justify-center gap-1 bg-white/60 backdrop-blur px-4 py-2 rounded-full mx-auto max-w-fit shadow-sm border border-white/50 transition-all mt-4">
                                <Icon name="refresh" size={12}/> ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ (Emergency Restore)
                            </button>
                        </div>

                        {/* Permission Error Modal */}
                        {permissionError && (
                            <div className="fixed inset-0 bg-black/80 z-[100] flex items-center justify-center p-4">
                                <div className="bg-white p-6 rounded-xl max-w-lg w-full text-center">
                                    <Icon name="alert" size={48} className="text-red-500 mx-auto mb-4"/>
                                    <h2 className="text-xl font-bold text-slate-800 mb-2">‡∏ï‡∏¥‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á (Permission Denied)</h2>
                                    <p className="text-slate-600 mb-4">‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Å‡πÑ‡∏ß‡πâ‡∏Ñ‡∏£‡∏±‡∏ö ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏¥‡∏£‡πå‡∏ò‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡πÄ‡∏õ‡∏¥‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô Firebase ‡∏Å‡πà‡∏≠‡∏ô</p>
                                    <div className="bg-slate-100 p-4 rounded-lg text-left text-sm text-slate-700 mb-6">
                                        1. ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö <a href="https://console.firebase.google.com" target="_blank" className="text-blue-600 underline">Firebase Console</a><br/>
                                        2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå {'>'} ‡πÄ‡∏°‡∏ô‡∏π‡∏ã‡πâ‡∏≤‡∏¢ <b>Firestore Database</b><br/>
                                        3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ñ‡∏ö <b>Rules</b><br/>
                                        4. ‡∏•‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏õ‡∏∞‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡πÅ‡∏ó‡∏ô:<br/>
                                        <pre className="bg-slate-800 text-green-400 p-2 rounded mt-2 font-mono overflow-x-auto text-xs">
rules_version = '2';
service cloud.firestore {'{'}
  match /databases/{'{'}database{'}'}/documents {'{'}
    match /{' {document=**} '} {'{'}
      allow read, write: if true;
    {'}'}
  {'}'}
{'}'}
                                        </pre>
                                        5. ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <b>Publish</b>
                                    </div>
                                    <button onClick={() => window.location.reload()} className="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold w-full hover:bg-blue-700">‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß (‡∏Å‡∏î‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä)</button>
                                </div>
                            </div>
                        )}

                        {/* PIN Modal */}
                        {selectedProfile && (
                            <div className="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                                <div className="bg-white/90 backdrop-blur-xl p-8 rounded-2xl w-full max-w-xs text-center shadow-2xl border border-white/50">
                                    <div className="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 font-bold text-2xl shadow-inner">
                                        {selectedProfile.name[0]}
                                    </div>
                                    <h3 className="font-bold text-xl mb-1 text-slate-800">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</h3>
                                    <p className="text-slate-500 mb-6 font-medium">‡∏Ñ‡∏∏‡∏ì {selectedProfile.name}</p>
                                    <input type="password" maxLength="6" className="w-full text-center text-3xl tracking-[0.5em] border-b-2 border-slate-200 focus:border-blue-500 outline-none py-2 mb-8 bg-transparent font-mono text-slate-800 placeholder-slate-300 transition-all" autoFocus value={pinInput} onChange={e=>setPinInput(e.target.value)} placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/>
                                    <div className="flex gap-3">
                                        <button onClick={()=>setSelectedProfile(null)} className="flex-1 py-3 rounded-xl bg-slate-100 text-slate-600 font-medium hover:bg-slate-200 transition-colors">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                                        <button onClick={handleLogin} className="flex-1 py-3 rounded-xl bg-blue-600 text-white font-bold shadow-lg shadow-blue-500/30 hover:bg-blue-700 transition-all transform active:scale-95">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Register Modal */}
                        {showRegisterModal && (
                            <div className="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                                <div className="bg-white/95 backdrop-blur-xl p-6 rounded-2xl w-full max-w-sm shadow-2xl border border-white/50">
                                    <h3 className="font-bold text-xl mb-6 text-slate-800 flex items-center gap-2">
                                        <div className="bg-blue-100 p-2 rounded-lg text-blue-600"><Icon name="userPlus" size={20}/></div> ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà
                                    </h3>
                                    <div className="space-y-4">
                                        <input className="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none transition-all" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å (Nickname)" value={newName} onChange={e=>setNewName(e.target.value)}/>
                                        <div className="flex gap-2 p-1 bg-slate-100 rounded-xl">
                                            <button onClick={()=>setNewRole('staff')} className={`flex-1 py-2 rounded-lg text-sm font-medium transition-all ${newRole==='staff'?'bg-white text-blue-700 shadow-sm':'text-slate-500 hover:text-slate-700'}`}>‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</button>
                                            <button onClick={()=>setNewRole('manager')} className={`flex-1 py-2 rounded-lg text-sm font-medium transition-all ${newRole==='manager'?'bg-white text-blue-700 shadow-sm':'text-slate-500 hover:text-slate-700'}`}>‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</button>
                                        </div>
                                        <input className="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none text-center tracking-widest font-mono text-lg transition-all" placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™ PIN (4 ‡∏´‡∏•‡∏±‡∏Å)" maxLength="4" value={newPin} onChange={e=>setNewPin(e.target.value)}/>
                                        <div className="flex gap-3 pt-4">
                                            <button onClick={()=>setShowRegisterModal(false)} className="flex-1 py-3 rounded-xl bg-slate-100 text-slate-600 font-medium hover:bg-slate-200 transition-colors">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                                            <button onClick={handleRegister} className="flex-1 py-3 rounded-xl bg-blue-600 text-white font-bold shadow-lg shadow-blue-500/30 hover:bg-blue-700 transition-all transform active:scale-95">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            }

            return (
                <div className="min-h-screen pb-20">
                    <header className="bg-white/80 backdrop-blur-md px-4 py-3 shadow-sm sticky top-0 z-20 flex justify-between items-center border-b border-slate-200/50">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-xl flex items-center justify-center text-white font-bold text-xl shadow-lg shadow-blue-500/20">V</div>
                            <div><h1 className="font-bold text-slate-800">Volvo Finance</h1><div className="text-xs text-slate-500 font-medium">{currentUserData.name} <span className="bg-slate-100 px-1.5 py-0.5 rounded text-[10px] uppercase ml-1 border border-slate-200">{currentUserData.role}</span></div></div>
                        </div>
                        <button onClick={()=>{setCurrentUserData(null); setActiveTab('dashboard');}} className="p-2 rounded-lg hover:bg-slate-100 text-slate-400 transition-colors"><Icon name="logout" size={20} /></button>
                    </header>
                    
                    <main className="p-4 space-y-5 max-w-3xl mx-auto">
                        <div className="bg-gradient-to-br from-slate-800 to-slate-900 rounded-3xl p-6 text-white shadow-2xl relative overflow-hidden group">
                            <div className="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full blur-2xl -mr-10 -mt-10 transition-transform group-hover:scale-110"></div>
                            <div className="absolute bottom-0 left-0 w-24 h-24 bg-blue-500/20 rounded-full blur-2xl -ml-5 -mb-5 transition-transform group-hover:scale-110"></div>
                            
                            <div className="relative z-10">
                                <div className="flex justify-between items-start mb-4">
                                    <div className="flex items-center gap-2 text-slate-400 text-xs font-medium tracking-wider bg-white/10 px-3 py-1 rounded-full backdrop-blur-md"><Icon name="creditCard" size={12}/> SERVICE FUND</div>
                                    <Icon name="building" className="text-slate-600" size={24}/>
                                </div>
                                <div className="text-5xl font-bold tracking-tight mb-1">{formatMoney(balance).split('.')[0]}<span className="text-2xl text-slate-400 font-normal">.{formatMoney(balance).split('.')[1]}</span></div>
                                <div className="text-slate-400 text-xs mt-2">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</div>
                            </div>
                        </div>

                        <div className="grid grid-cols-2 gap-4">
                            <button onClick={()=>setShowRequestModal(true)} className="bg-white/90 backdrop-blur-sm p-5 rounded-2xl shadow-sm border border-white/50 flex items-center gap-4 hover:shadow-md hover:scale-[1.02] transition-all group">
                                <div className="bg-blue-50 text-blue-600 w-12 h-12 rounded-xl flex items-center justify-center group-hover:bg-blue-600 group-hover:text-white transition-colors"><Icon name="minusCircle" size={24}/></div>
                                <div className="text-left"><div className="font-bold text-slate-800">‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</div><div className="text-xs text-slate-500 font-medium">Request Expense</div></div>
                            </button>
                            {currentUserData.role === 'manager' && (
                            <button onClick={()=>setShowDepositModal(true)} className="bg-white/90 backdrop-blur-sm p-5 rounded-2xl shadow-sm border border-white/50 flex items-center gap-4 hover:shadow-md hover:scale-[1.02] transition-all group">
                                <div className="bg-emerald-50 text-emerald-600 w-12 h-12 rounded-xl flex items-center justify-center group-hover:bg-emerald-600 group-hover:text-white transition-colors"><Icon name="plusCircle" size={24}/></div>
                                <div className="text-left"><div className="font-bold text-slate-800">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</div><div className="text-xs text-slate-500 font-medium">Add Deposit</div></div>
                            </button>
                            )}
                        </div>
                        
                        {/* Tabs */}
                        <div className="flex bg-slate-200/50 p-1.5 rounded-2xl text-sm font-medium text-slate-500 backdrop-blur-sm">
                             <button onClick={()=>setActiveTab('dashboard')} className={`flex-1 py-2.5 rounded-xl transition-all ${activeTab==='dashboard'?'bg-white text-blue-700 shadow-sm font-bold':'hover:text-slate-700'}`}>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</button>
                             <button onClick={()=>setActiveTab('myRequests')} className={`flex-1 py-2.5 rounded-xl transition-all ${activeTab==='myRequests'?'bg-white text-blue-700 shadow-sm font-bold':'hover:text-slate-700'}`}>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</button>
                             {currentUserData.role === 'manager' && (
                                <button onClick={()=>setActiveTab('approvals')} className={`flex-1 py-2.5 rounded-xl transition-all flex items-center justify-center gap-2 ${activeTab==='approvals'?'bg-white text-blue-700 shadow-sm font-bold':'hover:text-slate-700'}`}>
                                    ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ {totalPending > 0 && <span className="bg-rose-500 text-white text-[10px] px-1.5 py-0.5 rounded-full">{totalPending}</span>}
                                </button>
                             )}
                        </div>
                        
                        {/* Dashboard */}
                        {activeTab === 'dashboard' && (
                            <div className="space-y-3">
                                <h3 className="font-bold text-slate-700 flex items-center gap-2 px-1"><Icon name="history" size={18} className="text-blue-500"/> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                                {transactions.length === 0 ? <div className="text-center py-12 text-slate-400 bg-white/50 rounded-2xl border border-dashed border-slate-300">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß</div> :
                                transactions.map(tx => (
                                    <div key={tx.id} className="bg-white/90 backdrop-blur-sm p-4 rounded-2xl border border-white/50 shadow-sm flex justify-between items-center hover:shadow-md transition-shadow">
                                        <div className="flex items-center gap-4">
                                            <div className={`w-12 h-12 rounded-xl flex items-center justify-center shadow-sm ${tx.type==='income'?'bg-emerald-50 text-emerald-600':'bg-slate-50 text-slate-500'}`}>
                                                <Icon name={tx.type==='income'?'trendingUp':'trendingDown'} size={20}/>
                                            </div>
                                            <div>
                                                <div className="font-bold text-slate-800">{tx.description}</div>
                                                <div className="text-xs text-slate-400 font-medium mt-0.5 flex items-center gap-1"><Icon name="clock" size={10}/> {formatDate(tx.createdAt)} ‚Ä¢ {tx.performer}</div>
                                            </div>
                                        </div>
                                        <div className={`font-bold text-lg ${tx.type==='income'?'text-emerald-600':'text-slate-700'}`}>{tx.type==='income'?'+':'-'}{formatMoney(tx.amount)}</div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {/* My Requests */}
                        {activeTab === 'myRequests' && (
                            <div className="space-y-3">
                                {requests.filter(r => currentUserData.role === 'manager' || r.requester === currentUserData.name).length === 0 ? 
                                <div className="text-center py-12 text-slate-400 bg-white/50 rounded-2xl border border-dashed border-slate-300">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div> :
                                requests.filter(r => currentUserData.role === 'manager' || r.requester === currentUserData.name).map(req => (
                                    <div key={req.id} className="bg-white/90 backdrop-blur-sm p-5 rounded-2xl border border-white/50 shadow-sm hover:shadow-md transition-shadow">
                                        <div className="flex justify-between mb-3">
                                            <div className="font-bold text-slate-800 text-lg">{req.description}</div>
                                            <span className={`text-[10px] px-2.5 py-1 rounded-lg uppercase font-bold tracking-wide h-fit border ${req.status==='pending'?'bg-amber-50 text-amber-600 border-amber-100':req.status==='approved'?'bg-emerald-50 text-emerald-600 border-emerald-100':'bg-rose-50 text-rose-600 border-rose-100'}`}>{req.status}</span>
                                        </div>
                                        <div className="flex justify-between text-sm items-end border-t border-slate-100 pt-3">
                                            <div className="text-slate-400 font-medium flex items-center gap-1"><Icon name="clock" size={12}/> {formatDate(req.createdAt)}</div>
                                            <div className="font-bold text-xl text-slate-800">{formatMoney(req.amount)}</div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {/* Approvals */}
                        {activeTab === 'approvals' && (
                            <div className="space-y-6">
                                {pendingUsers.length > 0 && (
                                    <div className="space-y-3">
                                        <h4 className="font-bold text-sm text-slate-600 flex items-center gap-2 px-1"><Icon name="userPlus" size={16} className="text-blue-500"/> ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà ({pendingUsers.length})</h4>
                                        {pendingUsers.map(u => (
                                            <div key={u.id} className="bg-blue-50/80 backdrop-blur-sm border border-blue-100 p-4 rounded-2xl flex justify-between items-center shadow-sm">
                                                <div className="flex items-center gap-3">
                                                    <div className="w-10 h-10 bg-white rounded-full flex items-center justify-center font-bold text-blue-600 shadow-sm border border-blue-100">{u.name[0]}</div>
                                                    <div><div className="font-bold text-slate-800">{u.name}</div><div className="text-xs text-slate-500 uppercase font-medium bg-white px-2 py-0.5 rounded border border-blue-100 w-fit">{u.role}</div></div>
                                                </div>
                                                <div className="flex gap-2">
                                                    <button onClick={()=>db.collection('artifacts').doc(appId).collection('public').doc('data').collection('users').doc(u.id).update({status:'active'})} className="bg-blue-600 text-white px-4 py-2 rounded-xl text-sm font-bold shadow-lg shadow-blue-500/30 hover:bg-blue-700 transition-all">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                                                    <button onClick={()=>db.collection('artifacts').doc(appId).collection('public').doc('data').collection('users').doc(u.id).delete()} className="bg-white text-rose-500 border border-rose-200 px-4 py-2 rounded-xl text-sm font-bold hover:bg-rose-50 transition-all">‡∏•‡∏ö</button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                <div className="space-y-3">
                                    <h4 className="font-bold text-sm text-slate-600 flex items-center gap-2 px-1"><Icon name="wallet" size={16} className="text-amber-500"/> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å ({pendingRequests.length})</h4>
                                    {pendingRequests.length === 0 ? <div className="text-center py-8 text-slate-400 bg-white/50 rounded-2xl border border-dashed border-slate-300">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div> :
                                    pendingRequests.map(req => (
                                        <div key={req.id} className="bg-white/90 backdrop-blur-sm border-l-4 border-l-amber-400 p-5 rounded-2xl shadow-sm hover:shadow-md transition-all border-y border-r border-white/50">
                                            <div className="flex justify-between mb-2">
                                                <div>
                                                    <div className="font-bold text-xl text-slate-800">{req.description}</div>
                                                    <div className="text-xs text-slate-500 font-medium bg-slate-100 px-2 py-1 rounded-lg w-fit mt-1 flex items-center gap-1"><Icon name="user" size={10}/> ‡∏Ç‡∏≠‡πÇ‡∏î‡∏¢ {req.requester}</div>
                                                </div>
                                                <div className="font-bold text-2xl text-slate-800">{formatMoney(req.amount)}</div>
                                            </div>
                                            <div className="flex gap-3 pt-4 border-t border-slate-100 mt-2">
                                                <button onClick={()=>updateReqStatus(req.id, 'approved', req)} className="flex-1 bg-emerald-600 text-white py-2.5 rounded-xl text-sm font-bold shadow-lg shadow-emerald-500/30 hover:bg-emerald-700 transition-all">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                                                <button onClick={()=>updateReqStatus(req.id, 'rejected')} className="flex-1 bg-white border border-slate-200 text-slate-600 py-2.5 rounded-xl text-sm font-bold hover:bg-slate-50 transition-all">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                        
                    </main>
                    
                    {/* Modals */}
                    {showRequestModal && (
                        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-in">
                            <div className="bg-white p-6 rounded-2xl w-full max-w-sm shadow-2xl">
                                <h3 className="font-bold text-xl mb-6 text-slate-800 flex items-center gap-2"><div className="bg-blue-100 p-1.5 rounded-lg text-blue-600"><Icon name="minusCircle" size={20}/></div> ‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</h3>
                                <input className="w-full border p-3.5 rounded-xl mb-3 bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none transition-all" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢" value={description} onChange={e=>setDescription(e.target.value)} autoFocus/>
                                <input className="w-full border p-3.5 rounded-xl mb-6 bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none transition-all text-lg font-medium" type="number" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô" value={amount} onChange={e=>setAmount(e.target.value)}/>
                                <div className="flex gap-3">
                                    <button onClick={()=>setShowRequestModal(false)} className="flex-1 py-3 bg-slate-100 rounded-xl text-slate-600 font-bold hover:bg-slate-200 transition-colors">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                                    <button onClick={submitRequest} className="flex-1 py-3 bg-blue-600 text-white rounded-xl font-bold shadow-lg shadow-blue-500/30 hover:bg-blue-700 transition-all">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠</button>
                                </div>
                            </div>
                        </div>
                    )}
                     {showDepositModal && (
                        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-in">
                            <div className="bg-white p-6 rounded-2xl w-full max-w-sm shadow-2xl">
                                <h3 className="font-bold text-xl mb-6 text-slate-800 flex items-center gap-2"><div className="bg-emerald-100 p-1.5 rounded-lg text-emerald-600"><Icon name="plusCircle" size={20}/></div> ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏≠‡∏á‡∏Å‡∏•‡∏≤‡∏á</h3>
                                <select className="w-full border p-3.5 rounded-xl mb-3 bg-slate-50 focus:bg-white focus:ring-2 focus:ring-emerald-500 outline-none transition-all" value={depositCategory} onChange={e=>setDepositCategory(e.target.value)}>
                                    {INCOME_CATEGORIES.map(c => <option key={c.id} value={c.id}>{c.icon} {c.label}</option>)}
                                </select>
                                <input className="w-full border p-3.5 rounded-xl mb-3 bg-slate-50 focus:bg-white focus:ring-2 focus:ring-emerald-500 outline-none transition-all" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°" value={description} onChange={e=>setDescription(e.target.value)} />
                                <input className="w-full border p-3.5 rounded-xl mb-6 bg-slate-50 focus:bg-white focus:ring-2 focus:ring-emerald-500 outline-none transition-all text-lg font-medium" type="number" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô" value={amount} onChange={e=>setAmount(e.target.value)}/>
                                <div className="flex gap-3">
                                    <button onClick={()=>setShowDepositModal(false)} className="flex-1 py-3 bg-slate-100 rounded-xl text-slate-600 font-bold hover:bg-slate-200 transition-colors">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                                    <button onClick={submitDeposit} className="flex-1 py-3 bg-emerald-600 text-white rounded-xl font-bold shadow-lg shadow-emerald-500/30 hover:bg-emerald-700 transition-all">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>